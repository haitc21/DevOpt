# Files and Configuration Structure - Terraform Configuration Language

Trang này hướng dẫn cách **đặt tên, tổ chức, và lưu trữ các tệp cấu hình Terraform**, đồng thời giải thích cách Terraform **đánh giá (evaluate) các module** trong quá trình thực thi.

## 1.  File Extension (Phần mở rộng tệp)

- `.tf` → cú pháp gốc của Terraform  
- `.tf.json` → **biến thể dựa trên JSON**, thuận tiện cho việc sinh tự động hoặc xử lý bằng lcode.

## 2. Text Encoding

- Các tệp cấu hình Terraform **phải sử dụng mã hóa UTF-8**.
- Theo quy ước, Terraform dùng **kiểu xuống dòng Unix (LF)**, mặc dù **Windows-style (CRLF)** cũng được chấp nhận.

## 2. Directories and Modules (Thư mục và Module)

Một **module** là tập hợp các tệp `.tf` và/hoặc `.tf.json` được đặt **trong cùng một thư mục**.

- **Module = thư mục chứa các file cấu hình Terraform ở cấp cao nhất.**
- Các thư mục con **được xem như các module riêng biệt**, và **không tự động được đưa vào module cha**.

>Note: Terraform **đánh giá toàn bộ các tệp cấu hình trong một module** — nghĩa là tất cả các `.tf` trong cùng thư mục được **xử lý như một tài liệu duy nhất**. Việc chia code thành nhiều tệp (`main.tf`, `variables.tf`, `outputs.tf`, v.v.) chỉ để **dễ đọc và dễ bảo trì**, **không ảnh hưởng** đến cách Terraform thực thi.

---

### 3. Gọi Module khác (Module Calls)

Một module Terraform có thể **gọi module con (child module)** thông qua từ khóa [`module`](https://developer.hashicorp.com/terraform/language/modules)

- Module con có thể nằm **trong thư mục con của module cha** hoặc **ở vị trí khác trong hệ thống tệp**.  
- Cũng có thể **tải module từ nguồn bên ngoài**, ví dụ: [Terraform Registry](https://registry.terraform.io).

Ví dụ:

```hcl
module "vpc" {
  source = "./modules/vpc"
}

module "s3" {
  source = "terraform-aws-modules/s3-bucket/aws"
  version = "~> 3.0"
}
```

## 4. The Root Module (Module gốc)

- Terraform luôn chạy trong context của một “root module”.
- Trong Terraform CLI:
  - Root module là thư mục làm việc hiện tại (working directory) — nơi bạn chạy lệnh terraform `init`, `plan`, hoặc `apply`.
  - Bạn có thể chỉ định root module khác bằng tham số dòng lệnh, nhưng điều này hiếm khi cần thiết.
- Trong HCP Terraform hoặc Terraform Enterprise:
  - Root module mặc định là thư mục gốc của cấu hình được cung cấp (qua Git repo hoặc upload trực tiếp).
  - Cấu hình workspace có thể chỉ định thư mục con làm root module.
